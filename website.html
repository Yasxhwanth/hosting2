<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gemini 2.0 Flash ‚Äî Modern UI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<!-- Prism.js CSS for syntax highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
<style>
  /* Reset & Base */
  * { box-sizing:border-box; margin:0; padding:0; transition:0.2s all ease-in-out; }
  body { font-family:'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:linear-gradient(135deg,#667eea,#764ba2); color:#1f2937; min-height:100vh; display:flex; flex-direction:column; }
  h2,h3 { color:#111827; }

  /* Container & Cards */
  .container { max-width:1300px; margin:32px auto; display:grid; grid-template-columns:1fr 560px; gap:24px; padding:16px; }
  .card { background:rgba(255,255,255,0.95); border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,0.08); display:flex; flex-direction:column; backdrop-filter: blur(10px); }
  .card h2,.card h3 { margin-bottom:12px; }
  .section { margin-bottom:20px; }

  /* Inputs */
  label { font-size:13px; color:#6b7280; margin-bottom:6px; display:block; }
  input,textarea { width:100%; padding:14px; border-radius:10px; border:1px solid #d1d5db; font-family:monospace; font-size:14px; background:white; }
  textarea { min-height:160px; resize: vertical; }

  /* Buttons */
  .btn { padding:12px 18px; border-radius:10px; border:none; font-weight:600; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:all 0.2s; display:flex; align-items:center; justify-content:center; }
  .btn-primary { background:#4f46e5; color:white; }
  .btn-primary:hover { background:#4338ca; transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.15); }
  .btn-success { background:#10b981; color:white; }
  .btn-success:hover { background:#059669; transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.15); }
  .btn-secondary { background:#f3f4f6; color:#374151; }
  .btn-secondary:hover { background:#e5e7eb; transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.15); }

  /* Spinner */
  .spinner { border:3px solid rgba(255,255,255,0.3); border-top:3px solid white; border-radius:50%; width:16px; height:16px; animation:spin 1s linear infinite; margin-left:8px; }
  @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }

  /* Actions & Status */
  .actions { display:flex; gap:12px; align-items:center; margin-top:12px; }
  .status { margin-left:auto; font-size:13px; color:#6b7280; }

  /* Output */
  pre { background:#111827; color:#e6eef8; padding:16px; border-radius:10px; overflow:auto; max-height:420px; white-space:pre-wrap; font-size:14px; font-family:monospace; }

  /* Preview */
  iframe { width:100%; height:700px; border-radius:10px; border:1px solid #e5e7eb; }

  /* Header & Toggle */
  .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:24px; }
  .toggle { background:#f3f4f6; border-radius:20px; padding:6px 14px; cursor:pointer; font-size:13px; color:#374151; font-weight:600; user-select:none; }
  .toggle:hover { background:#e5e7eb; }

  /* Dark Mode */
  body.dark { background:#0f172a; color:#f1f5f9; }
  body.dark .card { background:rgba(15,23,42,0.95); color:#f1f5f9; }
  body.dark input, body.dark textarea { background:#1e293b; color:#f1f5f9; border:1px solid #334155; }
  body.dark pre { background:#111827; color:#e6eef8; }

  /* Responsive */
  @media (max-width:1100px) { .container { grid-template-columns:1fr; } iframe { height:500px; } }
</style>
</head>
<body>

<div class="container">

  <!-- Left: Controls -->
  <div class="card">
    <div class="header">
      <h2>Gemini 2.0 Flash</h2>
      <div class="toggle" id="modeToggle">üåô Dark Mode</div>
    </div>
    <p style="color:#6b7280;font-size:13px;">Private testing only. Paste your Google API key for Gemini 2.0 Flash.</p>

    <div class="section">
      <label>API Key (for testing only)</label>
      <input id="apikey" type="password" placeholder="Paste your Google API key" value="AIzaSyDZyYUf-Tm3U2MKa0U_8NlJVgawVCp1Qps" />

    </div>

    <div class="section">
      <label>Prompt / Brief</label>
      <textarea id="prompt" placeholder="e.g. Build a one-page todo app with localStorage"></textarea>
    </div>

    <div class="actions">
      <button id="generate" class="btn btn-primary">Generate <div class="spinner" style="display:none;"></div></button>
      <button id="mock" class="btn btn-success">Load Mock</button>
      <div id="status" class="status">idle</div>
    </div>

    <div class="section" style="margin-top:20px;">
      <div style="display:flex; align-items:center; justify-content:space-between">
        <strong>Raw model output</strong>
        <span style="color:#9ca3af;font-size:12px;">(syntax-highlighted)</span>
      </div>
      <pre id="rawOut" class="language-html">// model output will appear here</pre>
    </div>

    <div class="actions">
      <button id="copy" class="btn btn-secondary">Copy raw</button>
      <button id="download" class="btn btn-secondary">Download index.html</button>
    </div>
  </div>

  <!-- Right: Preview -->
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h3 style="margin:0">Preview</h3>
      <span style="color:#6b7280;font-size:12px;">tries <code>iframe.srcdoc</code> ‚Üí fallback blob</span>
    </div>
    <div style="margin-top:16px;">
      <iframe id="previewFrame" title="preview"></iframe>
    </div>
  </div>

</div>

<!-- Prism.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-markup.min.js"></script>

<script>
  const modeToggle = document.getElementById('modeToggle');
  const generateBtn = document.getElementById('generate');
  const spinner = generateBtn.querySelector('.spinner');
  const apiKeyEl = document.getElementById('apikey');
  const promptEl = document.getElementById('prompt');
  const rawOut = document.getElementById('rawOut');
  const previewFrame = document.getElementById('previewFrame');
  const status = document.getElementById('status');
  const mockBtn = document.getElementById('mock');
  const copyBtn = document.getElementById('copy');
  const downloadBtn = document.getElementById('download');
  let lastBlobUrl = null;

  // Dark/Light Mode Toggle
  modeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    modeToggle.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  });

  function revokeLastBlob(){ if(lastBlobUrl){ try{ URL.revokeObjectURL(lastBlobUrl); }catch(e){} lastBlobUrl=null;} }
  function setPreview(html){ revokeLastBlob(); try{ previewFrame.srcdoc=html; previewFrame.removeAttribute('src'); return;}catch(e){ const blob=new Blob([html],{type:'text/html'}); lastBlobUrl=URL.createObjectURL(blob); previewFrame.src=lastBlobUrl;} }
  function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
  function extractHtmlFromText(text){
    if(!text||typeof text!=='string') return '';
    const htmlMatch=text.match(/<!doctype html[\s\S]*<\/html>/i)||text.match(/<html[\s\S]*<\/html>/i);
    if(htmlMatch) return htmlMatch[0];
    const bodyMatch=text.match(/<body[\s\S]*<\/body>/i);
    if(bodyMatch) return '<!doctype html>\n<html>\n'+bodyMatch[0]+'\n</html>';
    if(/<\w+[^>]*>/.test(text)) return text;
    return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Generated</title><style>body{font-family:system-ui;padding:20px;background:#fff;color:#0b1220}</style></head><body><pre>${escapeHtml(text)}</pre></body></html>`;
  }

  async function callGeminiGenerateContent(prompt, apiKey){
    const url=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${encodeURIComponent(apiKey)}`;
    const body={contents:[{role:'user',parts:[{text:`You are an assistant that outputs ONLY the full contents of a single file named index.html. Include CSS within <style> and JS within <script>. No extra commentary.\n\nBrief:\n${prompt}`}]}]};
    const resp=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    if(!resp.ok){ const text=await resp.text(); throw new Error(`API error ${resp.status}: ${text}`); }
    const json=await resp.json();
    let candidate=null;
    try{
      if(json.candidates && json.candidates.length){ const c=json.candidates[0];
        if(c.content){
          if(Array.isArray(c.content.parts) && c.content.parts[0] && c.content.parts[0].text) candidate=c.content.parts.map(p=>p.text||'').join('');
          else if(Array.isArray(c.content) && c.content[0] && (c.content[0].text || (c.content[0].parts && c.content[0].parts[0] && c.content[0].parts[0].text))) candidate=c.content.map(item=>{if(item.text) return item.text; if(item.parts && item.parts[0] && item.parts[0].text) return item.parts.map(pp=>pp.text||'').join(''); return '';}).join('');
          else if(typeof c.content==='string') candidate=c.content;
        }
        if(!candidate && typeof c.output==='string') candidate=c.output;
      }
    }catch(e){ console.warn('Candidate parsing issue', e); }
    if(!candidate && json.output && Array.isArray(json.output) && json.output.length){ try{ const out=json.output[0]; if(out.content && out.content[0] && out.content[0].text) candidate=out.content[0].text; }catch(e){} }
    if(!candidate && json.outputText) candidate=json.outputText;
    if(!candidate && json.text) candidate=json.text;
    if(!candidate) candidate=JSON.stringify(json,null,2);
    return candidate;
  }

  generateBtn.addEventListener('click', async () => {
    const prompt = promptEl.value.trim();
    const apiKey = apiKeyEl.value.trim();
    if(!prompt) return alert('Enter a prompt');
    if(!apiKey) return alert('Enter API key');

    spinner.style.display='inline-block';
    status.textContent='‚è≥ Generating...';
    generateBtn.disabled = true;

    try{
      const genText = await callGeminiGenerateContent(prompt, apiKey);
      rawOut.textContent = genText;
      Prism.highlightElement(rawOut); // syntax highlight
      setPreview(extractHtmlFromText(genText));
      status.textContent='‚úÖ Done';
    } catch(err){
      rawOut.textContent='ERROR: '+err.message;
      Prism.highlightElement(rawOut);
      alert('Generation error: '+err.message);
      status.textContent='‚ùå Error';
    } finally{
      spinner.style.display='none';
      generateBtn.disabled=false;
    }
  });

  mockBtn.addEventListener('click',()=>{
    const sample=`<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mock App</title><style>body{font-family:system-ui;padding:20px;background:#fff}button{background:#4f46e5;color:white;padding:8px;border-radius:6px;border:0}</style></head><body><h1>Mock generated app</h1><p>Brief: ${escapeHtml(promptEl.value||'sample')}</p><button onclick="alert('hello')">Click me</button></body></html>`;
    rawOut.textContent=sample;
    Prism.highlightElement(rawOut);
    setPreview(sample);
    status.textContent='mock loaded';
  });

  copyBtn.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(rawOut.textContent||''); alert('Copied raw output'); }catch(e){alert('Copy failed: '+e.message);} });
  downloadBtn.addEventListener('click',()=>{ const content=rawOut.textContent||''; const blob=new Blob([content],{type:'text/html'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url;a.download='index.html';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url); });
  window.addEventListener('beforeunload',()=>revokeLastBlob());
</script>

</body>
</html>
